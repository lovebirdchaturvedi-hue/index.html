import React, { useState, useEffect } from 'react';
import { 
  Globe, ShieldCheck, Lock, MessageSquare, MapPin, 
  Trash2, Plus, UserPlus, Ban, CheckCircle, 
  ChevronRight, Phone, Mail, Facebook, Edit3 
} from 'lucide-react';

const ADMIN_PIN = "1818";
const WHATSAPP_LINK = "https://wa.me/919266418868";
const FB_LINK = "https://www.facebook.com/share/1CtwjV4rXG/";
const EMAIL = "info@apdglobaltrade.com";
const PHONE_IN = "+91 92664 18868";
const PHONE_US = "+1 (202) 780-1366";

const LOCATIONS = [
  { country: "India", city: "New Delhi", addr: "B-24, Sector 3, Rohini, New Delhi, 110085" },
  { country: "USA", city: "Washington D.C.", addr: "1717 Pennsylvania Avenue NW, Suite 1025, DC 20006" },
  { country: "UAE", city: "Dubai", addr: "Level 14, Boulevard Plaza Tower 1, Sheikh Mohammed Bin Rashid Blvd" },
  { country: "China", city: "Guangzhou", addr: "No. 5, Huaxia Road, Tianhe District, Guangzhou, 510623" }
];

// Initial Data Generator
const generateBulkLeads = () => {
  const agri = ["ICUMSA 45 Sugar", "Refined Sunflower Oil", "1121 Sella Basmati", "Yellow Corn", "Soybean Non-GMO", "Wheat Grade 2"];
  const indus = ["Copper Cathodes", "Aluminum Ingots", "Urea 46%", "Solar Panels", "Bitumen VG30", "Used Rails"];
  const origins = ["UAE", "Saudi Arabia", "USA", "China", "Vietnam", "Turkey"];
  
  return Array.from({ length: 110 }, (_, i) => ({
    id: `RFQ-${20000 + i}`,
    product: i % 2 === 0 ? agri[Math.floor(Math.random()*agri.length)] : indus[Math.floor(Math.random()*indus.length)],
    qty: `${Math.floor(Math.random() * 500) + 50} Containers`,
    origin: origins[Math.floor(Math.random()*origins.length)],
    type: i % 2 === 0 ? 'Agriculture' : 'Industrial',
    urgency: i % 15 === 0 ? 'High' : 'Regular'
  }));
};

export default function App() {
  const [view, setView] = useState('home');
  const [leads, setLeads] = useState(generateBulkLeads());
  const [suppliers, setSuppliers] = useState([
    { id: 'SUP-001', name: 'Al-Bayan Trading', category: 'Agriculture', status: 'Active' }
  ]);
  const [bannedList, setBannedList] = useState(['BAN-999']);
  const [currency, setCurrency] = useState('USD');
  const [isAdmin, setIsAdmin] = useState(false);
  const [pin, setPin] = useState("");
  const [showPinModal, setShowPinModal] = useState(false);

  // Auth Guard for Admin
  const handleAdminAccess = () => {
    if (pin === ADMIN_PIN) {
      setIsAdmin(true);
      setShowPinModal(false);
      setView('admin');
    } else {
      alert("Invalid Security PIN");
    }
    setPin("");
  };

  const deleteLead = (id) => {
    setLeads(leads.filter(l => l.id !== id));
  };

  const addLead = (newLead) => {
    setLeads([{ ...newLead, id: `RFQ-${Date.now()}` }, ...leads]);
  };

  const addSupplier = (sup) => {
    setSuppliers([{ ...sup, id: `SUP-${Math.floor(Math.random()*1000)}` }, ...suppliers]);
  };

  const toggleBan = (id) => {
    if (bannedList.includes(id)) {
      setBannedList(bannedList.filter(i => i !== id));
    } else {
      setBannedList([...bannedList, id]);
    }
  };

  return (
    <div className="min-h-screen bg-[#FDFDFD] text-slate-900 font-sans">
      {/* Floating Elements */}
      <a href={WHATSAPP_LINK} target="_blank" className="fixed bottom-8 right-8 z-[60] bg-[#25d366] text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 font-bold text-xs uppercase hover:scale-105 transition-all">
        <MessageSquare size={18} /> WhatsApp Support
      </a>

      {/* Navigation */}
      <nav className="fixed w-full z-50 bg-white/80 backdrop-blur-xl border-b border-slate-100 py-4 px-6">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
            <div className="bg-emerald-600 text-white p-2 rounded-xl"><Globe size={20} /></div>
            <div>
              <h1 className="text-xl font-black italic tracking-tighter uppercase leading-none">APD Global</h1>
              <p className="text-[8px] font-bold text-slate-400 tracking-widest uppercase">The Trade Terminal</p>
            </div>
          </div>
          
          <div className="hidden md:flex gap-8 items-center text-[10px] font-black uppercase tracking-widest text-slate-500">
            <button onClick={() => setView('leads')} className="hover:text-emerald-600">Market Board</button>
            <button onClick={() => setView('pricing')} className="hover:text-emerald-600">Pricing</button>
            <button onClick={() => setView('contact')} className="hover:text-emerald-600">Offices</button>
            <div className="bg-slate-100 p-1 rounded-lg flex gap-1">
              {['USD', 'INR'].map(c => (
                <button key={c} onClick={() => setCurrency(c)} className={`px-3 py-1 rounded-md transition-all ${currency === c ? 'bg-white shadow text-slate-900' : 'text-slate-400'}`}>{c}</button>
              ))}
            </div>
          </div>

          <button 
            onClick={() => isAdmin ? setView('admin') : setShowPinModal(true)}
            className="bg-slate-900 text-white px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-emerald-600 transition-all"
          >
            {isAdmin ? 'Master Console' : 'Supplier Login'}
          </button>
        </div>
      </nav>

      {/* Content Router */}
      <main className="pt-24 min-h-[80vh]">
        {view === 'home' && <HomeHero setView={setView} />}
        {view === 'leads' && <MarketBoard leads={leads} setView={setView} bannedList={bannedList} />}
        {view === 'pricing' && <Pricing currency={currency} />}
        {view === 'contact' && <Offices />}
        {view === 'terms' && <Terms />}
        {view === 'admin' && isAdmin && (
          <AdminConsole 
            leads={leads} 
            addLead={addLead} 
            deleteLead={deleteLead} 
            suppliers={suppliers}
            addSupplier={addSupplier}
            bannedList={bannedList}
            toggleBan={toggleBan}
          />
        )}
      </main>

      {/* Footer */}
      <footer className="bg-white border-t border-slate-100 py-20 px-6 mt-20">
        <div className="max-w-7xl mx-auto grid md:grid-cols-4 gap-12">
          <div className="col-span-1">
            <h2 className="text-xl font-black italic mb-6 uppercase tracking-tighter">APD GLOBAL TRADE</h2>
            <p className="text-xs font-medium text-slate-400 leading-relaxed italic mb-8">Verified Institutional Terminal. Connecting global demand with verified supply chains. Zero brokerage.</p>
            <div className="flex gap-4">
              <a href={FB_LINK} target="_blank" className="p-3 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-600 hover:text-white transition-all"><Facebook size={20} /></a>
              <a href={WHATSAPP_LINK} target="_blank" className="p-3 bg-emerald-50 text-emerald-600 rounded-xl hover:bg-emerald-600 hover:text-white transition-all"><Phone size={20} /></a>
            </div>
          </div>
          <div className="md:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-8">
            {LOCATIONS.map(loc => (
              <div key={loc.country}>
                <h4 className="text-[10px] font-black uppercase tracking-widest mb-4 text-slate-900 border-b border-slate-100 pb-2">{loc.country} Hub</h4>
                <p className="text-[10px] font-medium text-slate-400 uppercase leading-loose">{loc.addr}</p>
              </div>
            ))}
          </div>
        </div>
        <div className="max-w-7xl mx-auto mt-20 pt-8 border-t border-slate-50 flex justify-between items-center text-[9px] font-bold text-slate-300 uppercase tracking-widest">
          <span>© 2024 APD Global Trade</span>
          <div className="flex gap-6">
            <span className="cursor-pointer hover:text-emerald-600" onClick={() => setView('terms')}>Terms</span>
            <span className="cursor-pointer hover:text-emerald-600" onClick={() => setView('contact')}>Contact</span>
          </div>
        </div>
      </footer>

      {/* PIN Modal */}
      {showPinModal && (
        <div className="fixed inset-0 z-[100] bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-4">
          <div className="bg-white rounded-[3rem] p-10 w-full max-w-sm shadow-2xl">
            <h3 className="text-xl font-black uppercase text-center mb-8 italic">Security Authentication</h3>
            <input 
              type="password" 
              placeholder="PIN" 
              className="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-4 text-center text-3xl font-black mb-6 outline-none focus:border-emerald-500" 
              value={pin} 
              onChange={(e) => setPin(e.target.value)}
              onKeyDown={(e) => e.key === 'Enter' && handleAdminAccess()}
            />
            <button onClick={handleAdminAccess} className="w-full bg-slate-900 text-white py-4 rounded-xl font-black uppercase text-xs tracking-widest mb-4">Authorize</button>
            <button onClick={() => setShowPinModal(false)} className="w-full text-slate-400 text-[10px] font-bold uppercase tracking-widest">Cancel</button>
          </div>
        </div>
      )}
    </div>
  );
}

// VIEW COMPONENTS

const HomeHero = ({ setView }) => (
  <div className="max-w-7xl mx-auto px-6 py-20 text-center">
    <div className="inline-flex items-center gap-2 bg-emerald-50 text-emerald-700 px-4 py-2 rounded-full mb-8 border border-emerald-100">
      <div className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse" />
      <span className="text-[9px] font-black uppercase tracking-widest">Live: 115 Institutional Queries</span>
    </div>
    <h1 className="text-7xl md:text-[10rem] font-black tracking-tighter uppercase italic leading-[0.8] mb-12">
      Trade <span className="text-emerald-600">Fast.</span> <br/> Direct.
    </h1>
    <p className="text-slate-400 max-w-2xl mx-auto text-lg mb-12 font-medium">Verified institutional marketplace for Bulk Commodities. Access LOI/BCL backed demand directly from buyers across 14 nations.</p>
    <div className="flex flex-col sm:flex-row gap-4 justify-center">
      <button onClick={() => setView('leads')} className="bg-emerald-600 text-white px-10 py-5 rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-emerald-200">View Market Board</button>
      <button onClick={() => setView('pricing')} className="bg-white border border-slate-200 px-10 py-5 rounded-2xl font-black uppercase text-xs tracking-widest shadow-sm">Become Supplier</button>
    </div>
  </div>
);

const MarketBoard = ({ leads, setView, bannedList }) => {
  const [filter, setFilter] = useState('All');
  const filtered = filter === 'All' ? leads : leads.filter(l => l.type === filter);

  return (
    <div className="max-w-7xl mx-auto px-6 py-10">
      <div className="flex flex-col md:flex-row justify-between items-end mb-16 gap-6">
        <div>
          <h2 className="text-4xl font-black italic uppercase tracking-tighter">Market Terminal</h2>
          <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Verified Global Demand Board</p>
        </div>
        <div className="bg-slate-100 p-1 rounded-2xl flex gap-1">
          {['All', 'Agriculture', 'Industrial'].map(f => (
            <button key={f} onClick={() => setFilter(f)} className={`px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${filter === f ? 'bg-white shadow text-emerald-600' : 'text-slate-500'}`}>{f}</button>
          ))}
        </div>
      </div>
      <div className="grid md:grid-cols-3 gap-6">
        {filtered.map((lead) => (
          <div key={lead.id} className="bg-white border border-slate-100 p-8 rounded-[2.5rem] shadow-sm hover:shadow-xl transition-all relative overflow-hidden group">
            {lead.urgency === 'High' && <div className="absolute top-0 right-0 bg-red-500 text-white text-[8px] font-black px-4 py-1 uppercase rotate-45 translate-x-3 translate-y-1">Urgent</div>}
            <span className={`text-[9px] font-black px-3 py-1.5 rounded-full uppercase mb-6 inline-block ${lead.type === 'Agriculture' ? 'bg-emerald-50 text-emerald-600' : 'bg-blue-50 text-blue-600'}`}>{lead.type}</span>
            <h3 className="text-xl font-black uppercase italic mb-6 text-slate-900 leading-tight">{lead.product}</h3>
            <div className="flex items-center gap-2 mb-8 text-xs font-bold text-slate-400 uppercase">
              <MapPin size={14} className="text-emerald-500" /> Buyer Location: {lead.origin}
            </div>
            <div className="flex justify-between items-end border-t pt-6 border-slate-50">
              <div>
                <p className="text-2xl font-black italic text-slate-900 tracking-tighter">{lead.qty}</p>
                <p className="text-[8px] font-bold text-slate-400 uppercase tracking-widest">Volume Required</p>
              </div>
              <button onClick={() => setView('pricing')} className="bg-slate-900 text-white p-4 rounded-xl hover:bg-emerald-600 transition-colors">
                <Lock size={16} />
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

const AdminConsole = ({ leads, addLead, deleteLead, suppliers, addSupplier, bannedList, toggleBan }) => {
  const [tab, setTab] = useState('queries');
  const [newLead, setNewLead] = useState({ product: '', qty: '', origin: '', type: 'Agriculture', urgency: 'Regular' });
  const [newSup, setNewSup] = useState({ name: '', category: 'Agriculture' });

  return (
    <div className="max-w-7xl mx-auto px-6 py-10">
      <div className="bg-slate-900 rounded-[3.5rem] p-10 md:p-16 text-white shadow-2xl">
        <div className="flex flex-col md:flex-row justify-between gap-8 mb-16">
          <div>
            <h2 className="text-4xl font-black italic uppercase tracking-tighter flex items-center gap-4">
              <ShieldCheck size={36} className="text-emerald-500" /> Master Console
            </h2>
            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-2">Platform Administration & Ecosystem Control</p>
          </div>
          <div className="bg-white/10 p-1 rounded-2xl flex gap-1 self-start">
            {['queries', 'suppliers', 'bans'].map(t => (
              <button key={t} onClick={() => setTab(t)} className={`px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${tab === t ? 'bg-white text-slate-900' : 'text-slate-400'}`}>{t}</button>
            ))}
          </div>
        </div>

        {tab === 'queries' && (
          <div className="space-y-12">
            <div className="bg-white/5 p-8 rounded-3xl border border-white/10">
              <h4 className="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-2"><Plus size={16} /> Inject New Bulk RFQ</h4>
              <div className="grid md:grid-cols-4 gap-4 mb-6">
                <input placeholder="Product Name" className="bg-white/10 p-4 rounded-xl outline-none text-xs font-bold" value={newLead.product} onChange={e=>setNewLead({...newLead, product: e.target.value})} />
                <input placeholder="Qty (e.g. 500 MT)" className="bg-white/10 p-4 rounded-xl outline-none text-xs font-bold" value={newLead.qty} onChange={e=>setNewLead({...newLead, qty: e.target.value})} />
                <input placeholder="Destination" className="bg-white/10 p-4 rounded-xl outline-none text-xs font-bold" value={newLead.origin} onChange={e=>setNewLead({...newLead, origin: e.target.value})} />
                <select className="bg-white/10 p-4 rounded-xl outline-none text-xs font-bold" value={newLead.type} onChange={e=>setNewLead({...newLead, type: e.target.value})}>
                  <option className="bg-slate-900">Agriculture</option>
                  <option className="bg-slate-900">Industrial</option>
                </select>
              </div>
              <button onClick={() => {addLead(newLead); setNewLead({product:'', qty:'', origin:'', type:'Agriculture', urgency:'Regular'})}} className="bg-emerald-600 text-white px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Broadcast RFQ</button>
            </div>

            <div className="bg-white/5 p-8 rounded-3xl border border-white/10">
              <h4 className="text-xs font-black uppercase tracking-widest mb-6">Manage Active RFQs ({leads.length})</h4>
              <div className="max-h-[400px] overflow-y-auto space-y-3 pr-4 custom-scrollbar">
                {leads.map(lead => (
                  <div key={lead.id} className="flex items-center justify-between p-4 bg-white/5 rounded-2xl hover:bg-white/10 transition-all border border-white/5">
                    <div>
                      <p className="text-xs font-black uppercase italic">{lead.product}</p>
                      <p className="text-[8px] font-bold text-slate-500 uppercase tracking-widest">{lead.qty} • {lead.origin}</p>
                    </div>
                    <button onClick={() => deleteLead(lead.id)} className="p-2 text-red-400 hover:bg-red-400/20 rounded-lg transition-all"><Trash2 size={16}/></button>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {tab === 'suppliers' && (
          <div className="space-y-12">
            <div className="bg-white/5 p-8 rounded-3xl border border-white/10">
              <h4 className="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-2"><UserPlus size={16} /> Manually Create Supplier Profile</h4>
              <p className="text-[9px] text-slate-400 mb-6 uppercase tracking-widest italic">Use this for suppliers who paid you via direct bank transfer or cash.</p>
              <div className="grid md:grid-cols-2 gap-4 mb-6">
                <input placeholder="Company Name" className="bg-white/10 p-4 rounded-xl outline-none text-xs font-bold" value={newSup.name} onChange={e=>setNewSup({...newSup, name: e.target.value})} />
                <select className="bg-white/10 p-4 rounded-xl outline-none text-xs font-bold" value={newSup.category} onChange={e=>setNewSup({...newSup, category: e.target.value})}>
                  <option className="bg-slate-900">Agriculture</option>
                  <option className="bg-slate-900">Industrial</option>
                </select>
              </div>
              <button onClick={() => {addSupplier(newSup); setNewSup({name:'', category:'Agriculture'})}} className="bg-emerald-600 text-white px-8 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Activate Supplier</button>
            </div>

            <div className="bg-white/5 p-8 rounded-3xl border border-white/10">
              <h4 className="text-xs font-black uppercase tracking-widest mb-6">Platform Suppliers</h4>
              <div className="space-y-3">
                {suppliers.map(sup => (
                  <div key={sup.id} className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/5">
                    <div className="flex items-center gap-4">
                      <div className="w-10 h-10 bg-emerald-500/20 rounded-xl flex items-center justify-center text-emerald-500"><CheckCircle size={20}/></div>
                      <div>
                        <p className="text-xs font-black uppercase">{sup.name}</p>
                        <p className="text-[8px] font-bold text-slate-500 uppercase tracking-widest">{sup.id} • {sup.category}</p>
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button onClick={() => toggleBan(sup.id)} className={`px-4 py-2 rounded-lg text-[8px] font-black uppercase tracking-widest ${bannedList.includes(sup.id) ? 'bg-red-500 text-white' : 'bg-slate-800 text-slate-400'}`}>
                        {bannedList.includes(sup.id) ? 'Banned' : 'Active'}
                      </button>
                    </div>
       
